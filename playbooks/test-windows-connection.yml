---
# Simple playbook to test connectivity to Windows hosts

- name: Test Windows Host Connectivity
  hosts: "{{ windows_host | default('windows2025') }}"
  gather_facts: false

  tasks:
    - name: Display target host information
      ansible.builtin.debug:
        msg:
          - "Testing connectivity to: {{ inventory_hostname }}"
          - "Host address:            {{ ansible_host | default('not set') }}"
          - "Connection method:       {{ ansible_connection | default('not set') }}"
          - "Port:                    {{ ansible_port | default('not set') }}"
          - "Shell type:              {{ ansible_shell_type | default('not set') }}"
          - "User:                    {{ ansible_user | default('not set') }}"

    - name: "{{ __task_name }}"
      vars:
        __task_name: "Test {{ ansible_connection | upper }} / {{ ansible_shell_type | capitalize }} connectivity with win_ping"
      register: ping_result
      ansible.windows.win_ping:

    - name: Test 'whoami' (Command Prompt)
      changed_when: false
      register: whoami_result
      ansible.windows.win_command: "whoami"

    - name: Test 'Get-Date' (PowerShell)
      changed_when: false
      register: date_result
      ansible.windows.win_shell: "Get-Date"

    - name: Display ping result
      when: ping_result is succeeded
      ansible.builtin.debug:
        msg:
          - "===================================================="
          - "âœ“ Connection successful!"
          - "===================================================="
          - "Host:          {{ inventory_hostname }}"
          - "Ping result:   {{ ping_result.ping }}"
          - "Whoami result: {{ whoami_result.stdout | trim }}"
          - "Date result:   {{ date_result.stdout | trim }}"
          - "===================================================="
          - "{{ ansible_connection | upper }} and {{ ansible_shell_type | capitalize }} are working correctly"
          - "===================================================="
...
